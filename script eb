local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")
local HttpService = game:GetService("HttpService")
local Drawing = Drawing or nil

local localPlayer = Players.LocalPlayer
local keys = { -- Keys geradas
    "XZ8Y2F7KT4M9J6LP", "W3QK7ZRPTX91B8MF", "PL97X5RTZ8M4K2FQ", "M8XZQ5TKRF2971LP",
    "T4KZXM9RPL82F7Q3", "Z7PLM9FQX5TKR821", "X5MRZ8FQ2T9K7PL4", "QF29TX4KZM81R75L",
    "PL8ZX2TKM5QF7R91", "FQ7LM2X9T5PLZ8RK", "KX9T7PLRZM5FQ248", "RZ82MX7F9T5LQKP4",
    "F7QK2R9TZ8MLX5P3", "TKX5R9L2FQ7PM8Z4", "M9PLTF7KX82RZ5Q3", "Z2R8T9L5MX7FQ4KP",
    "LPQ7M5F2TZ8RKX49", "ZM8FQ5R2K7TLX9P3", "TXR5L8M9FQ2KZ7P4", "K9L2ZQ8M5F7RXPT3"
}

local function saveUserKey(playerName, key)
    local data = {
        Name = playerName,
        Key = key,
        Expiration = os.time() + (30 * 24 * 60 * 60) -- 30 dias em segundos
    }
    writefile("validated_user.json", HttpService:JSONEncode(data))
end

local function loadUserKey()
    if isfile("validated_user.json") then
        local data = HttpService:JSONDecode(readfile("validated_user.json"))
        if os.time() < data.Expiration then
            return data
        else
            delfile("validated_user.json") -- Remove arquivo expirado
        end
    end
    return nil
end

local validatedUser = loadUserKey()

local function validateKey(inputKey)
    for _, key in ipairs(keys) do
        if inputKey == key then
            saveUserKey(localPlayer.Name, inputKey)
            return true
        end
    end
    return false
end

if not validatedUser then
    local validated = false
    repeat
        print("Digite sua key no console:")
        local inputKey = tostring(io.read()):gsub("%s", "") -- Usuário insere a key no console

        if validateKey(inputKey) then
            print("Key válida! Aimbot e ESP liberados.")
            validated = true
        else
            print("Key inválida. Tente novamente.")
        end
    until validated
else
    print("Bem-vindo de volta, " .. validatedUser.Name .. "! Aimbot e ESP liberados.")
end

-- Configurações do Aimbot e ESP
local aimKey = Enum.UserInputType.MouseButton2
local fovRadius = 50 -- FOV
local fovCircle = Drawing.new("Circle")
fovCircle.Visible = true
fovCircle.Color = Color3.new(1, 1, 0)
fovCircle.Thickness = 2
fovCircle.Filled = false
fovCircle.Radius = fovRadius
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

local function isInFOV(player)
    if player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character.Head
        local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
        local mousePos = UserInputService:GetMouseLocation()
        return (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude <= fovRadius
    end
    return false
end

local function getClosestTarget()
    local closestPlayer, closestDistance = nil, math.huge
    local mousePos = UserInputService:GetMouseLocation()

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
            local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
            if distance < closestDistance and distance <= fovRadius then
                closestPlayer = player
                closestDistance = distance
            end
        end
    end
    return closestPlayer
end

local function aimAtTarget(target)
    if target and target.Character and target.Character:FindFirstChild("Head") then
        local head = target.Character.Head
        Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, head.Position) -- 100% precisão
    end
end

UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == aimKey then
        local target = getClosestTarget()
        if target then
            aimAtTarget(target)
        end
    end
end)

RunService.RenderStepped:Connect(function()
    fovCircle.Position = UserInputService:GetMouseLocation()
end)

print("Script carregado com sucesso. Aimbot e ESP ativados!")
